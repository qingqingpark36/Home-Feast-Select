<!-- pages/admin/order-manage/order-manage.wxml -->
<view class="container order-manage-container">
  <!-- 状态筛选 -->
  <view class="status-filter">
    <view
      class="filter-item {{currentStatus === '' ? 'active' : ''}}"
      bindtap="selectStatus"
      data-status="">
      全部
    </view>
    <view
      class="filter-item {{currentStatus === 'pending' ? 'active' : ''}}"
      bindtap="selectStatus"
      data-status="pending">
      待处理
    </view>
    <view
      class="filter-item {{currentStatus === 'confirmed' ? 'active' : ''}}"
      bindtap="selectStatus"
      data-status="confirmed">
      已确认
    </view>
    <view
      class="filter-item {{currentStatus === 'completed' ? 'active' : ''}}"
      bindtap="selectStatus"
      data-status="completed">
      已完成
    </view>
  </view>

  <!-- 订单列表 -->
  <view wx:if="{{loading}}" class="loading">加载中...</view>

  <view wx:elif="{{orders.length === 0}}" class="empty-state">
    <text>暂无订单</text>
  </view>

  <view wx:else class="order-list">
    <view wx:for="{{orders}}" wx:key="_id" class="order-card">
      <!-- 订单信息 -->
      <view class="order-header">
        <view class="user-info">
          <image class="user-avatar" src="{{item.userAvatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="user-name">{{item.userName}}</view>
        </view>
        <view class="order-status {{item.status}}">{{getStatusText(item.status)}}</view>
      </view>

      <view class="order-time">下单时间：{{formatTime(item.createTime)}}</view>

      <!-- 菜品列表 -->
      <view class="order-dishes">
        <view wx:for="{{item.dishes}}" wx:key="dishId" wx:for-item="dish" class="dish-item">
          <view class="dish-name">{{dish.name}}</view>
          <view class="dish-count">x{{dish.count}}</view>
        </view>
      </view>

      <!-- 备注 -->
      <view wx:if="{{item.notes}}" class="order-notes">
        备注：{{item.notes}}
      </view>

      <!-- 操作按钮 -->
      <view class="order-actions">
        <button
          wx:if="{{item.status === 'pending'}}"
          class="action-btn confirm-btn"
          bindtap="updateStatus"
          data-id="{{item._id}}"
          data-status="confirmed">
          确认订单
        </button>
        <button
          wx:if="{{item.status === 'confirmed'}}"
          class="action-btn complete-btn"
          bindtap="updateStatus"
          data-id="{{item._id}}"
          data-status="completed">
          完成订单
        </button>
      </view>
    </view>
  </view>
</view>
